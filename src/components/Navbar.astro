---
import imageUrl from "../assets/logo_sos-removebg-preview.webp";
---

<style>
  .backdrop-blur-glass {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  .transition-navbar {
    transition: all 0.3s ease-in-out;
  }
  /* Ensure dropdown appears above other content */
  .dropdown-menu {
    z-index: 9999 !important;
  }

  /* Fix text colors in dropdown */
  .dropdown-menu a {
    color: #374151 !important; /* gray-700 */
  }

  .dropdown-menu a:hover {
    background-color: #f3f4f6 !important; /* gray-100 */
  }

  /* Ensure dropdown button arrow rotates */
  .dropdown-arrow {
    transition: transform 0.2s ease;
  }

  .dropdown-open .dropdown-arrow {
    transform: rotate(180deg);
  }
</style>

<nav
  id="navbar"
  class={`fixed top-0 left-0 right-0 z-50 w-full transition-navbar ${["/", "/about"].includes(Astro.url.pathname) ? "bg-transparent text-white" : "bg-white text-black shadow-md"}`}
>
  <div
    class="max-w-screen-3xl flex flex-wrap items-center justify-between mx-auto p-4 lg:p-6 lg:px-20"
  >
    <!-- Logo -->
    <a href="/" class="flex items-center space-x-25">
      <img src={imageUrl.src} class="h-[60px]" alt="Logo" />
    </a>

    <!-- Mobile Toggle Button -->
    <button
      id="mobile-menu-button"
      type="button"
      class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg xl:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
    >
      <svg class="w-5 h-5" fill="none" viewBox="0 0 17 14">
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M1 1h15M1 7h15M1 13h15"></path>
      </svg>
    </button>

    <!-- Navbar Links -->
    <div id="navbar-default" class="hidden w-full xl:block xl:w-auto">
      <ul
        class="font-medium flex flex-col p-4 md:p-0 mt-4 xl:flex-row xl:space-x-8 xl:mt-0 text-sm"
      >
        <!-- ABOUT with Dropdown -->
        <li class="relative">
          <button
            id="about-dropdown-button"
            class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-green-600 focus:outline-none"
          >
            ABOUT
            <svg
              class="w-3 h-3 inline ml-1"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 011.06.02L10 11.585l3.71-4.354a.75.75 0 111.14.976l-4.25 5a.75.75 0 01-1.14 0l-4.25-5a.75.75 0 01.02-1.06z"
                clip-rule="evenodd"></path>
            </svg>
          </button>
          <div
            id="about-dropdown"
            class="hidden absolute z-50 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-0 ring-black ring-opacity-5"
          >
            <a
              href="/about"
              class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
              >Who We Are</a
            >
            <a
              href="/people"
              class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
              >People</a
            >
          </div>
        </li>
        <!-- ABOUT without Dropdown -->
        <!-- Other Links -->
        <li>
          <a
            href="/research"
            class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-green-600"
            >RESEARCH</a
          >
        </li>
        <li>
          <a
            href="/programs"
            class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-green-600"
            >PROGRAM OFFERED</a
          >
        </li>
        <li>
          <a
            href="/outreach"
            class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-green-600"
            >OUTREACH</a
          >
        </li>
        <li>
          <a
            href="/knowledgehub"
            class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-green-600"
            >KNOWLEDGE HUB</a
          >
        </li>
        <li class="relative">
          <button
            id="about-dropdown-buttonn"
            class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-green-600 focus:outline-none"
          >
            SUSTAINABILITY@IITM
            <svg
              class="w-3 h-3 inline ml-1"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 011.06.02L10 11.585l3.71-4.354a.75.75 0 111.14.976l-4.25 5a.75.75 0 01-1.14 0l-4.25-5a.75.75 0 01.02-1.06z"
                clip-rule="evenodd"></path>
            </svg>
          </button>
          <div
            id="about-dropdownn"
            class="hidden absolute z-50 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-0 ring-black ring-opacity-5"
          >
            <a
              href="/organisation"
              class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
              >Organisation</a
            >
            <a
              href="/policies"
              class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
              >Policies</a
            >
            <a
              href="../pages/health/health-wellness.md"
              class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
              >Health & Wellbeing</a
            >
          </div>
        </li>
        <!-- <li><a href="/knowledgehub" class="navbar-link block py-2 px-3 md:p-0 font-semibold text-[16px] hover:text-blue-600">SUSTAINABILITY@IITM</a></li> -->
        <li>
          <a href="" class="navbar-link block py-2 px-3 md:p-0"
            ><i class="fas fa-search"></i></a
          >
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const navbar = document.getElementById("navbar");
    const links = document.querySelectorAll(".navbar-link");
    const mobileBtn = document.getElementById("mobile-menu-button");
    const menu = document.getElementById("navbar-default");
    const aboutBtn = document.getElementById("about-dropdown-button");
    const aboutDropdown = document.getElementById("about-dropdown");

    const susBtn = document.getElementById("about-dropdown-buttonn");
    const susDropdown = document.getElementById("about-dropdownn");
    // Mobile toggle
    mobileBtn?.addEventListener("click", () => {
      menu?.classList.toggle("hidden");
    });

    // ABOUT dropdown toggle
    aboutBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      aboutDropdown?.classList.toggle("hidden");
    });

    susBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      susDropdown?.classList.toggle("hidden");
    });
    // Close dropdown when clicking outside
    document.addEventListener("click", (e) => {
      if (
        !aboutBtn?.contains(e.target as Node) &&
        !aboutDropdown?.contains(e.target as Node)
      ) {
        aboutDropdown?.classList.add("hidden");
      }
    });

    document.addEventListener("click", (e) => {
      if (
        !susBtn?.contains(e.target as Node) &&
        !susDropdown?.contains(e.target as Node)
      ) {
        susDropdown?.classList.add("hidden");
      }
    });

    // Scroll color logic
    function updateNavbar() {
      if (!navbar) return;
      const atTop = window.scrollY <= 50;
      const transparent = ["/", "/about"].includes(window.location.pathname);

      if (atTop && transparent) {
        navbar.classList.add("bg-transparent", "text-white");
        navbar.classList.remove("bg-white", "text-black", "shadow-md");
        links.forEach((link) => link.classList.remove("text-black"));
        links.forEach((link) => link.classList.add("text-white"));
      } else {
        navbar.classList.remove("bg-transparent", "text-white");
        navbar.classList.add("bg-white", "text-black", "shadow-md");
        links.forEach((link) => link.classList.remove("text-white"));
        links.forEach((link) => link.classList.add("text-black"));
      }
    }

    updateNavbar();
    window.addEventListener("scroll", () =>
      requestAnimationFrame(updateNavbar)
    );
  });
</script>
